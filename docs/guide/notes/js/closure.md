## 什么是闭包
> 红宝书(p178)上对于闭包的定义：闭包是指有权访问另外一个函数作用域中的变量的函数，

> MDN 对闭包的定义为：闭包是指那些能够访问自由变量的函数。`（其中自由变量，指在函数中使用的，但既不是函数参数arguments也不是函数的局部变量的变量，其实就是另外一个函数作用域中的变量。）`

## 闭包产生的原因?
首先要明白作用域链的概念，其实很简单，在ES5中只存在两种作用域————全局作用域和函数作用域，
`当访问一个变量时，解释器会首先在当前作用域查找标示符，如果没有找到，就去父作用域找，
直到找到该变量的标示符或者不在父作用域中，这就是作用域链，`
值得注意的是，每一个子函数都会拷贝上级的作用域，形成一个作用域的链条。
比如:
```javascript
var a = 1;
function f1() {
  var a = 2
  function f2() {
    var a = 3;
    console.log(a);//3
  }
}
```
在这段代码中，f1的作用域指向有全局作用域(window)和它本身，而f2的作用域指向全局作用域(window)、f1和它本身。而且作用域是从最底层向上找，直到找到全局作用域window为止，如果全局还没有的话就会报错。就这么简单一件事情！


## 闭包本质

就是，当前环境中存在指向父级作用域的引用。例子:

```javascript
function f1() {
  var a = 2
  function f2() {
    console.log(a);//2
  }
  return f2;
}
var x = f1();
x();
```

这里x会拿到父级作用域中的变量，输出2。因为在当前环境中，含有对f2的引用，f2恰恰引用了window、f1和f2的作用域。
因此f2可以访问到f1的作用域的变量。


那是不是只有返回函数才算是产生了闭包呢？、
回到闭包的本质，我们只需要让父级作用域的引用存在即可，因此我们还可以这么做：

```javascript
var f3;
function f1() {
  var a = 2
  f3 = function() {
    console.log(a);
  }
}
f1();
f3();
```

让f1执行，给f3赋值后，等于说现在f3拥有了window、f1和f3本身这几个作用域的访问权限，还是自底向上查找，最近是在f1中找到了a,因此输出2。
在这里是外面的变量f3存在着父级作用域的引用，因此产生了闭包，形式变了，本质没有改变。

